<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mutfak Asistanı Pro</title>
<script src="https://cdn.tailwindcss.com/3.4.16"></script>
<script>tailwind.config={theme:{extend:{colors:{primary:'#DF8820'},borderRadius:{'none':'0px','sm':'4px',DEFAULT:'8px','md':'12px','lg':'16px','xl':'20px','2xl':'24px','3xl':'32px','full':'9999px','button':'8px'}}}}</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
<style>
:where([class^="ri-"])::before { content: "\f3c2"; }
@keyframes scaleIn {
from { transform: scale(0.95); opacity: 0; }
to { transform: scale(1); opacity: 1; }
}
body {
font-family: 'Inter', sans-serif;
background-image: linear-gradient(to bottom right, rgba(223, 136, 32, 0.05), rgba(223, 136, 32, 0.02));
}
.card {
backdrop-filter: blur(10px);
background: rgba(255, 255, 255, 0.95);
box-shadow: 0 4px 20px rgba(223, 136, 32, 0.08);
border: 1px solid rgba(223, 136, 32, 0.15);
animation: scaleIn 0.3s ease-out;
position: relative;
overflow: hidden;
}
.card::before {
content: '';
position: absolute;
top: 0;
left: 0;
width: 100%;
height: 4px;
background: linear-gradient(90deg, #DF8820, rgba(223, 136, 32, 0.3));
}
.input-field {
transition: all 0.3s ease;
border: 2px solid transparent;
background: rgba(255, 255, 255, 0.9);
}
.input-field:focus {
outline: none;
border-color: #DF8820;
box-shadow: 0 0 0 3px rgba(223, 136, 32, 0.15);
background: white;
}
.custom-select {
appearance: none;
background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%236b7280'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'%3E%3C/path%3E%3C/svg%3E");
background-repeat: no-repeat;
background-position: right 0.75rem center;
background-size: 1rem;
padding-right: 2.5rem;
}
button {
transition: all 0.3s ease;
}
button.primary {
background: linear-gradient(45deg, #DF8820, #E69635);
color: white;
}
button.secondary {
background: rgba(223, 136, 32, 0.1);
color: #DF8820;
}
button.danger {
background: rgba(239, 68, 68, 0.1);
color: rgb(239, 68, 68);
}
/* Tablo görünümü için */
.settings-row:nth-child(even) {
    background-color: rgba(223, 136, 32, 0.03);
}
</style>
</head>
<body class="bg-gray-50 text-gray-900 min-h-screen">
<div class="container mx-auto px-4 py-8 max-w-6xl">
<header class="flex justify-between items-center mb-8">
<h1 class="text-3xl font-['Pacifico'] text-primary">Mutfak Asistanı</h1>
</header>

<main class="grid grid-cols-1 lg:grid-cols-2 gap-8">

<section class="bg-white/95 backdrop-blur rounded-lg shadow-md p-6 card lg:col-span-2">
    <div class="flex flex-col md:flex-row md:items-center justify-between mb-6">
        <div>
            <h2 class="text-2xl font-semibold flex items-center gap-2">
                <i class="ri-settings-4-line text-primary"></i> Standart Ölçü Ayarları
            </h2>
            <p class="text-gray-500 text-sm mt-1">Evindeki bardak ve kaşıkların gerçek boyutlarını buraya gir, hesaplamalar buna göre yapılsın.</p>
        </div>
        <button id="resetDefaultsBtn" class="text-sm text-red-500 hover:text-red-700 underline mt-2 md:mt-0">
            Fabrika Ayarlarına Dön
        </button>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="standardSettingsGrid">
        </div>
</section>

<section class="bg-white/95 backdrop-blur rounded-lg shadow-md p-6 card lg:col-span-2 border-t-0">
    <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold text-gray-700">Ekstra Özel Kaplar</h2>
        <span class="text-xs text-gray-500 bg-gray-100 px-2 py-1 rounded">Örn: "Babaannemin Tası"</span>
    </div>
    <div class="flex gap-2 mb-4">
        <input type="text" id="customUnitName" class="input-field flex-1 px-4 py-2 border border-gray-300 rounded-button" placeholder="Kap Adı">
        <input type="number" id="customUnitVolume" class="input-field w-32 px-4 py-2 border border-gray-300 rounded-button" placeholder="Hacim (ml)">
        <button id="addCustomUnitBtn" class="primary px-4 py-2 rounded-button">Ekle</button>
    </div>
    <div id="customUnitsList" class="flex flex-wrap gap-3"></div>
</section>

<section class="bg-white/95 backdrop-blur rounded-lg shadow-md p-6 card">
<h2 class="text-2xl font-semibold mb-6">Birim Dönüştürücü</h2>
<div class="space-y-4">
<div>
<label class="block text-sm font-medium mb-1">Malzeme</label>
<select id="ingredient" class="input-field custom-select w-full px-4 py-2 border border-gray-300 rounded-button bg-white">
<option value="un">Un</option>
<option value="seker">Şeker</option>
<option value="sut">Süt</option>
<option value="siviyag">Sıvı Yağ</option>
<option value="yogurt">Yoğurt</option>
<option value="bal">Bal</option>
<option value="tereyagi">Tereyağı</option>
<option value="pirinc">Pirinç</option>
<option value="su">Su</option>
</select>
</div>
<div class="grid grid-cols-2 gap-4">
<div>
<label class="block text-sm font-medium mb-1">Miktar</label>
<input type="number" id="amount" class="input-field w-full px-4 py-2 border border-gray-300 rounded-button" placeholder="1">
</div>
<div>
<label class="block text-sm font-medium mb-1">Kaynak</label>
<select id="sourceUnit" class="input-field custom-select w-full px-4 py-2 border border-gray-300 rounded-button bg-white"></select>
</div>
</div>
<div>
<label class="block text-sm font-medium mb-1">Hedef</label>
<select id="targetUnit" class="input-field custom-select w-full px-4 py-2 border border-gray-300 rounded-button bg-white"></select>
</div>
<div id="conversionResult" class="p-4 bg-gray-100 border border-gray-200 rounded-lg text-center font-bold text-lg text-primary mt-4">
Sonuç Bekleniyor...
</div>
</div>
</section>

<section class="bg-white/95 backdrop-blur rounded-lg shadow-md p-6 card">
<h2 class="text-2xl font-semibold mb-6">Tarif Yöneticisi</h2>
<div class="space-y-4">
<input type="text" id="recipeName" class="input-field w-full px-4 py-2 border border-gray-300 rounded-button" placeholder="Tarif Adı">
<div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
<div class="grid grid-cols-1 gap-2">
<select id="recipeIngredient" class="input-field custom-select w-full px-3 py-2 border border-gray-300 rounded-button bg-white">
<option value="un">Un</option>
<option value="seker">Şeker</option>
<option value="sut">Süt</option>
<option value="siviyag">Sıvı Yağ</option>
<option value="yogurt">Yoğurt</option>
<option value="bal">Bal</option>
<option value="tereyagi">Tereyağı</option>
<option value="pirinc">Pirinç</option>
<option value="su">Su</option>
</select>
<div class="flex gap-2">
<input type="number" id="recipeAmount" class="input-field w-24 px-3 py-2 border border-gray-300 rounded-button" placeholder="Miktar">
<select id="recipeUnit" class="input-field custom-select flex-1 px-3 py-2 border border-gray-300 rounded-button bg-white"></select>
</div>
<button id="addIngredientBtn" class="secondary w-full py-2 rounded-button mt-2">Listeye Ekle</button>
</div>
</div>
<div id="ingredientsList" class="space-y-2 max-h-40 overflow-y-auto min-h-[50px]"></div>
<button id="saveRecipeBtn" class="primary w-full py-3 rounded-button">Tarifi Kaydet</button>
</div>
</section>

</main>

<div class="mt-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="savedRecipes"></div>

</div>

<script>
// --- VERİ YAPILARI ---
const densityData = {
    un: 0.593, seker: 0.845, sut: 1.033, siviyag: 0.918,
    yogurt: 1.045, bal: 1.425, tereyagi: 0.911, pirinc: 0.873, su: 0.998
};

const ingredientNames = {
    un: 'un', seker: 'şeker', sut: 'süt', siviyag: 'sıvı yağ',
    yogurt: 'yoğurt', bal: 'bal', tereyagi: 'tereyağı', pirinc: 'pirinç', su: 'su'
};

// Sistem Varsayılanları (Sabit)
const defaultStandardUnits = {
    gram: { ml: 1, label: 'Gram', frozen: true },
    ml: { ml: 1, label: 'Mililitre', frozen: true },
    subardagi: { ml: 200, label: 'Su Bardağı' },
    cay: { ml: 100, label: 'Çay Bardağı' },
    yemek: { ml: 15, label: 'Yemek Kaşığı' },
    tatli: { ml: 10, label: 'Tatlı Kaşığı' },
    cay_kasigi: { ml: 5, label: 'Çay Kaşığı' },
    fincan: { ml: 70, label: 'Kahve Fincanı' }
};

// --- YARDIMCI FONKSİYONLAR ---

// Tüm birimleri (Varsayılan + Düzenlenmiş + Özel) getirir
function getEffectiveUnits() {
    // 1. Kullanıcının değiştirdiği standart ayarları al
    const overrides = JSON.parse(localStorage.getItem('unitOverrides') || '{}');
    
    // 2. Varsayılanlarla birleştir (Override varsa onu kullan)
    let effectiveStandards = {};
    for (let key in defaultStandardUnits) {
        if (defaultStandardUnits[key].frozen) {
            effectiveStandards[key] = defaultStandardUnits[key];
        } else {
            // Eğer override varsa hacmi ordan al, yoksa defaulttan al
            const volume = overrides[key] ? overrides[key] : defaultStandardUnits[key].ml;
            effectiveStandards[key] = {
                ml: parseFloat(volume),
                label: defaultStandardUnits[key].label // İsim değişmez
            };
        }
    }

    // 3. Tamamen yeni eklenen "Özel Kapları" al
    const customUnits = JSON.parse(localStorage.getItem('customUnits') || '{}');

    return { ...effectiveStandards, ...customUnits };
}

// Select kutularını doldur
function populateDropdowns() {
    const units = getEffectiveUnits();
    const selects = ['sourceUnit', 'targetUnit', 'recipeUnit'];
    
    selects.forEach(id => {
        const select = document.getElementById(id);
        if(!select) return;
        const currentVal = select.value;
        select.innerHTML = '';

        // Standartlar
        Object.keys(defaultStandardUnits).forEach(key => {
            const u = units[key];
            const option = document.createElement('option');
            option.value = key;
            // Etikette güncel hacmi göster
            if(u.frozen) option.textContent = u.label;
            else option.textContent = `${u.label} (${u.ml}ml)`;
            select.appendChild(option);
        });

        // Özel Kaplar
        const customKeys = Object.keys(JSON.parse(localStorage.getItem('customUnits') || '{}'));
        if(customKeys.length > 0) {
            const grp = document.createElement('optgroup');
            grp.label = "Özel Kaplarınız";
            customKeys.forEach(key => {
                const u = units[key];
                const opt = document.createElement('option');
                opt.value = key;
                opt.textContent = `${u.label} (${u.ml}ml)`;
                grp.appendChild(opt);
            });
            select.appendChild(grp);
        }

        if(currentVal && units[currentVal]) select.value = currentVal;
        else select.value = 'subardagi';
    });
}

// Ayarlar panelini çiz
function renderSettingsPanel() {
    const container = document.getElementById('standardSettingsGrid');
    container.innerHTML = '';
    
    const units = getEffectiveUnits();

    Object.keys(defaultStandardUnits).forEach(key => {
        if(defaultStandardUnits[key].frozen) return; // Gram ve ml düzenlenemez

        const u = units[key]; // Şu an geçerli olan değer
        
        const div = document.createElement('div');
        div.className = 'flex items-center justify-between p-3 bg-gray-50 border border-gray-200 rounded-lg settings-row';
        div.innerHTML = `
            <div class="flex items-center gap-3">
                <div class="bg-white p-2 rounded-full text-primary shadow-sm">
                    <i class="ri-scales-3-line"></i>
                </div>
                <span class="font-medium text-gray-700">${u.label}</span>
            </div>
            <div class="flex items-center gap-2">
                <input type="number" value="${u.ml}" min="1" step="0.1" 
                    class="std-unit-input w-20 px-2 py-1 text-right border border-gray-300 rounded focus:border-primary outline-none"
                    data-key="${key}">
                <span class="text-xs text-gray-500 font-medium w-6">ml</span>
            </div>
        `;
        container.appendChild(div);
    });

    // Input değişimlerini dinle
    document.querySelectorAll('.std-unit-input').forEach(input => {
        input.addEventListener('change', (e) => {
            const key = e.target.dataset.key;
            const newVal = parseFloat(e.target.value);
            
            if(newVal > 0) {
                // Ayarları kaydet
                const overrides = JSON.parse(localStorage.getItem('unitOverrides') || '{}');
                overrides[key] = newVal;
                localStorage.setItem('unitOverrides', JSON.stringify(overrides));
                
                // Her şeyi güncelle
                populateDropdowns();
                renderCustomUnitsList(); // Belki etkilemez ama temiz olsun
                calculateConversion();
                
                // Görsel geri bildirim
                e.target.style.borderColor = '#22c55e';
                setTimeout(() => e.target.style.borderColor = '#d1d5db', 1000);
            }
        });
    });
}

// Özel Kap Listesini Çiz
function renderCustomUnitsList() {
    const list = document.getElementById('customUnitsList');
    const customUnits = JSON.parse(localStorage.getItem('customUnits') || '{}');
    list.innerHTML = '';
    
    Object.entries(customUnits).forEach(([key, val]) => {
        const tag = document.createElement('div');
        tag.className = 'flex items-center gap-2 bg-orange-100 text-orange-800 px-3 py-1 rounded-full text-sm border border-orange-200';
        tag.innerHTML = `
            <span>${val.label}: <b>${val.ml}ml</b></span>
            <button onclick="removeCustomUnit('${key}')" class="hover:text-red-600"><i class="ri-close-circle-fill"></i></button>
        `;
        list.appendChild(tag);
    });
}

// --- DÖNÜŞÜM MANTIĞI ---
function calculateConversion() {
    const units = getEffectiveUnits();
    const amount = parseFloat(document.getElementById('amount').value);
    const fromUnitKey = document.getElementById('sourceUnit').value;
    const toUnitKey = document.getElementById('targetUnit').value;
    const ingredient = document.getElementById('ingredient').value;
    
    if(!amount || !fromUnitKey || !toUnitKey) return;

    const fromUnit = units[fromUnitKey];
    const toUnit = units[toUnitKey];
    const density = densityData[ingredient];

    // Her şeyi grama çevir (Ara birim)
    let gramValue = 0;

    // 1. Kaynağı ml'ye çevir
    let mlValue = amount * fromUnit.ml; 
    
    // 2. Yoğunluk hesabı (Sadece gram/ml geçişlerinde önemli)
    // Eğer kaynak 'gram' ise: mlValue aslında gramdır, yoğunluğa bölüp ml buluruz
    if (fromUnitKey === 'gram') {
        mlValue = amount / density;
    }

    // 3. Hedefe çevir
    let result = 0;
    if (toUnitKey === 'gram') {
        result = mlValue * density;
    } else {
        result = mlValue / toUnit.ml;
    }
    
    // Sonuç yazdır
    const displayRes = document.getElementById('conversionResult');
    displayRes.innerHTML = `
        <div class="text-gray-500 text-sm font-normal">
            ${amount} ${fromUnit.label} ${ingredientNames[ingredient]}
        </div>
        <div class="text-3xl mt-1 text-primary">
            = ${result.toFixed(2)} <span class="text-xl text-gray-600">${toUnit.label}</span>
        </div>
    `;
}

// --- ANA İŞLEMLER ---

document.addEventListener('DOMContentLoaded', () => {
    // Başlangıç Yüklemeleri
    renderSettingsPanel();
    renderCustomUnitsList();
    populateDropdowns();
    
    // Event Listeners: Dönüştürücü
    ['ingredient', 'amount', 'sourceUnit', 'targetUnit'].forEach(id => {
        document.getElementById(id).addEventListener('input', calculateConversion);
    });

    // Event Listeners: Standart Ayarları Sıfırla
    document.getElementById('resetDefaultsBtn').addEventListener('click', () => {
        if(confirm('Tüm standart ölçü ayarlarınız (bardak boyutları vb.) varsayılan değerlere dönecek. Emin misiniz?')) {
            localStorage.removeItem('unitOverrides');
            renderSettingsPanel();
            populateDropdowns();
            calculateConversion();
        }
    });

    // Event Listeners: Özel Kap Ekleme
    document.getElementById('addCustomUnitBtn').addEventListener('click', () => {
        const name = document.getElementById('customUnitName').value;
        const vol = parseFloat(document.getElementById('customUnitVolume').value);
        if(name && vol > 0) {
            const customUnits = JSON.parse(localStorage.getItem('customUnits') || '{}');
            customUnits['cust_' + Date.now()] = { label: name, ml: vol };
            localStorage.setItem('customUnits', JSON.stringify(customUnits));
            
            document.getElementById('customUnitName').value = '';
            document.getElementById('customUnitVolume').value = '';
            renderCustomUnitsList();
            populateDropdowns();
        }
    });

    // Event Listeners: Tarif Kaydetme (Basitleştirilmiş)
    const currentRecipeIngs = [];
    document.getElementById('addIngredientBtn').addEventListener('click', () => {
        const ing = document.getElementById('recipeIngredient').value;
        const amt = document.getElementById('recipeAmount').value;
        const uKey = document.getElementById('recipeUnit').value;
        if(!amt) return;

        const units = getEffectiveUnits();
        const u = units[uKey];
        
        // Listeye Ekle
        const li = document.createElement('div');
        li.className = 'flex justify-between bg-gray-50 p-2 text-sm rounded border border-gray-200';
        li.innerHTML = `<span>${amt} ${u.label} ${ingredientNames[ing]}</span> <span class="text-gray-400">(${u.ml * amt}ml hacim)</span>`;
        document.getElementById('ingredientsList').appendChild(li);

        currentRecipeIngs.push({ ing, amt, uKey });
        document.getElementById('recipeAmount').value = '';
    });

    document.getElementById('saveRecipeBtn').addEventListener('click', () => {
        const name = document.getElementById('recipeName').value;
        if(!name || currentRecipeIngs.length === 0) { alert('İsim ve malzeme girin'); return; }
        
        // Basitçe ekrana kart olarak ekle (LocalStorage kısmı önceki kodda vardı, burayı sade tuttum görüntü için)
        const card = document.createElement('div');
        card.className = 'bg-white p-4 rounded shadow border border-gray-100';
        let html = `<h3 class="font-bold text-lg text-primary">${name}</h3><ul class="text-sm mt-2 space-y-1">`;
        currentRecipeIngs.forEach(i => {
            const units = getEffectiveUnits(); // Kayıt anındaki birim değerini al
            html += `<li>• ${i.amt} ${units[i.uKey].label} ${ingredientNames[i.ing]}</li>`;
        });
        html += '</ul>';
        document.getElementById('savedRecipes').appendChild(card);
        
        // Temizle
        document.getElementById('recipeName').value = '';
        document.getElementById('ingredientsList').innerHTML = '';
        currentRecipeIngs.length = 0;
    });
});

// Global scope fonksiyonu (HTML'den çağrılabilmesi için)
window.removeCustomUnit = function(key) {
    const customUnits = JSON.parse(localStorage.getItem('customUnits') || '{}');
    delete customUnits[key];
    localStorage.setItem('customUnits', JSON.stringify(customUnits));
    renderCustomUnitsList();
    populateDropdowns();
};

</script>
</body>
</html>
